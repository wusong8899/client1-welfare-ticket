(()=>{var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var i in a)e.o(a,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:a[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";function a(e,t){return a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},a(e,t)}function i(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,a(e,t)}e.r(t),flarum.core.compat.extend;const r=flarum.core.compat["components/ExtensionPage"];var n=e.n(r);const l=flarum.core.compat["components/LoadingIndicator"];var o=e.n(l);const s=flarum.core.compat["components/Button"];var c=e.n(s);const p=flarum.core.compat["components/Modal"];var d=e.n(p);const u=flarum.core.compat["common/components/Select"];var f=e.n(u);const w=flarum.core.compat["utils/Stream"];var h=e.n(w);flarum.core.compat["common/components/Alert"];var k=function(e){function t(){return e.apply(this,arguments)||this}i(t,e);var a=t.prototype;return a.oninit=function(t){if(e.prototype.oninit.call(this,t),this.welfareTicketData=this.attrs.welfareTicketData,this.settingType="add",this.defaultAmount=200,this.winChance=h()(0),this.welfareTicketData){var a=this.welfareTicketData.id().toString();this.settingType="edit",this.welfareTicketID=h()(a.substring(1)),this.welfareTicketTitle=h()(this.welfareTicketData.title()),this.welfareTicketColor=h()(this.welfareTicketData.color()),this.welfareTicketImage=h()(this.welfareTicketData.image()),this.welfareTicketType=h()(this.welfareTicketData.type()),this.welfareTicketCost=h()(this.welfareTicketData.cost());var i=JSON.parse(this.welfareTicketData.settings());this.welfareTicketDealerBet=h()(i.dealerBet),this.welfareTicketDealerBetCut=h()(i.dealerBetCut),this.welfareTicketWin1Multiplier=h()(i.win1Multiplier),this.welfareTicketWin2Multiplier=h()(i.win2Multiplier),this.welfareTicketWin3Multiplier=h()(i.win3Multiplier)}else this.welfareTicketID=h()(""),this.welfareTicketTitle=h()(""),this.welfareTicketColor=h()(""),this.welfareTicketImage=h()(""),this.welfareTicketType=h()("1"),this.welfareTicketCost=h()(1),this.welfareTicketSettings=h()(""),this.welfareTicketDealerBet=h()(0),this.welfareTicketDealerBetCut=h()(0),this.welfareTicketWin1Multiplier=h()(),this.welfareTicketWin2Multiplier=h()(),this.welfareTicketWin3Multiplier=h()()},a.onColorBackgroundSelectionReady=function(e){this.welfareTicketImage()?$("#ColorBackgroundSelection").val("background"):$("#ColorBackgroundSelection").val("color")},a.className=function(){return"Modal--Large"},a.title=function(){return"add"===this.settingType?app.translator.trans("wusong8899-welfare-ticket.admin.welfare-add"):app.translator.trans("wusong8899-welfare-ticket.admin.welfare-edit")},a.content=function(){var e=this,t="position: absolute;right: 12px;top: 6px;width:24px;height:24px;background-color:"+this.welfareTicketColor()+";border-radius: var(--border-radius);",a="display:"+(this.welfareTicketImage()?"":"none"),i=this.welfareTicketImage()?"display:none":"";return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group",style:"text-align: left;"},m("div",null,m("div",{style:"display:none"},m("div",{class:"welfareTicketSettingsLabel"},app.translator.trans("wusong8899-welfare-ticket.admin.welfare-item-type")),m(f(),{value:this.welfareTicketType(),options:{1:app.translator.trans("wusong8899-welfare-ticket.admin.welfare-item-type-1")},buttonClassName:"Button",onchange:this.welfareTicketType})),m("div",{class:"welfareTicketSettingsLabel"},app.translator.trans("wusong8899-welfare-ticket.admin.welfare-item-id")),"add"===this.settingType&&m("input",{required:!0,className:"FormControl",type:"number",step:"1",min:"1",bidi:this.welfareTicketID}),"edit"===this.settingType&&m("input",{disabled:!0,required:!0,className:"FormControl",type:"number",step:"1",min:"1",bidi:this.welfareTicketID}),m("div",{style:"display:none",class:"welfareTicketSettingsLabel"},app.translator.trans("wusong8899-welfare-ticket.admin.welfare-item-cost")),m("input",{style:"display:none",required:!0,className:"FormControl",type:"number",step:"1",min:"1",bidi:this.welfareTicketCost}),m("div",{class:"welfareTicketSettingsLabel"},app.translator.trans("wusong8899-welfare-ticket.admin.welfare-item-win-multiplier")),m("input",{required:!0,style:"display: inline-block;width: 150px;",className:"FormControl",type:"number",step:"0.01",min:"1",bidi:this.welfareTicketWin1Multiplier,placeholder:app.translator.trans("wusong8899-welfare-ticket.admin.welfare-item-win-1multiplier")}),m("input",{required:!0,style:"display: inline-block;width: 150px;margin-left: 10px;",className:"FormControl",type:"number",step:"0.01",min:"1",bidi:this.welfareTicketWin2Multiplier,placeholder:app.translator.trans("wusong8899-welfare-ticket.admin.welfare-item-win-2multiplier")}),m("input",{required:!0,style:"display: inline-block;width: 150px;margin-left: 10px;",className:"FormControl",type:"number",step:"0.01",min:"1",bidi:this.welfareTicketWin3Multiplier,placeholder:app.translator.trans("wusong8899-welfare-ticket.admin.welfare-item-win-3multiplier")}),m("div",{class:"welfareTicketSettingsLabel"},app.translator.trans("wusong8899-welfare-ticket.admin.welfare-item-dealerBet")),m("input",{required:!0,className:"FormControl",type:"number",step:"1",min:"0",bidi:this.welfareTicketDealerBet}),m("div",{class:"welfareTicketSettingsLabel"},app.translator.trans("wusong8899-welfare-ticket.admin.welfare-item-dealerBetCut"),app.translator.trans("wusong8899-welfare-ticket.admin.welfare-item-dealerBetCut-Help")),m("input",{required:!0,className:"FormControl",type:"number",step:"1",min:"0",bidi:this.welfareTicketDealerBetCut}),m("div",{class:"welfareTicketSettingsLabel"},app.translator.trans("wusong8899-welfare-ticket.admin.welfare-item-color-background")),m("div",{style:"display: flex;gap: 10px;"},m("span",{class:"Select",oncreate:this.onColorBackgroundSelectionReady.bind(this)},m("select",{id:"ColorBackgroundSelection",class:"Select-input FormControl",buttonclassname:"Button",onchange:function(t){return e.switchColorBackground(t)}},m("option",{value:"background"},app.translator.trans("wusong8899-welfare-ticket.admin.welfare-item-background")),m("option",{value:"color"},app.translator.trans("wusong8899-welfare-ticket.admin.welfare-item-color"))),m("i",{"aria-hidden":"true",class:"icon fas fa-sort Select-caret"})),m("div",{id:"welfareTicketColorContainer",class:"welfareTicketColorAndBackground",style:i},m("div",{style:"width:10px"}),m("input",{maxlength:"20",placeholder:app.translator.trans("wusong8899-welfare-ticket.admin.welfare-item-color-placeholder"),className:"FormControl",bidi:this.welfareTicketColor,onchange:function(){return e.setGuaGuaLeColorPreview()}}),m("div",{style:"width:5px"}),m("div",{id:"welfareTicketColorPreview",style:t})),m("div",{id:"welfareTicketBackgroundContainer",class:"welfareTicketColorAndBackground",style:a},m("div",{style:"width:10px"}),m("input",{maxlength:"255",placeholder:app.translator.trans("wusong8899-welfare-ticket.admin.welfare-item-background-placeholder"),className:"FormControl",bidi:this.welfareTicketImage,onchange:function(){return e.setGuaGuaLeColorPreview()}}),m("div",{id:"welfareTicketBackgroundPreview"}))))),m("div",{className:"Form-group",style:"text-align: center;"},c().component({className:"Button Button--primary",type:"submit",loading:this.loading},"add"===this.settingType?app.translator.trans("wusong8899-guaguale.admin.guaguale-data-add"):app.translator.trans("wusong8899-guaguale.admin.guaguale-data-save"))," ",c().component({className:"Button welfareTicketButton--gray",loading:this.loading,onclick:function(){e.hide()}},app.translator.trans("wusong8899-guaguale.admin.guaguale-data-cancel")))))},a.switchColorBackground=function(e){var t=e.target.value;"color"===t?($("#welfareTicketColorContainer").css("display",""),$("#welfareTicketBackgroundContainer").css("display","none")):"background"===t&&($("#welfareTicketColorContainer").css("display","none"),$("#welfareTicketBackgroundContainer").css("display",""))},a.setGuaGuaLeColorPreview=function(){$("#welfareTicketColorPreview").css("background-color",this.welfareTicketColor())},a.precisionRound=function(e,t){var a=Math.pow(10,t);return Math.round(e*a)/a},a.getBackgroundColor=function(e){for(var t=0,a=0;a<e.length;a++)t=e.charCodeAt(a)+((t<<5)-t);for(var i="#",r=0;r<3;r++)i+=("00"+(t>>8*r&255).toString(16)).substr(-2);return i},a.onsubmit=function(e){var t=this;e.preventDefault(),this.loading=!0;var a=$("#ColorBackgroundSelection").val();"color"===a?this.welfareTicketImage(null):"background"===a&&this.welfareTicketColor(null);var i=JSON.stringify({dealerBet:this.welfareTicketDealerBet(),dealerBetCut:this.welfareTicketDealerBetCut(),win1Multiplier:this.welfareTicketWin1Multiplier,win2Multiplier:this.welfareTicketWin2Multiplier,win3Multiplier:this.welfareTicketWin3Multiplier});"edit"===this.settingType?this.welfareTicketData.save({title:this.welfareTicketTitle(),cost:this.welfareTicketCost(),type:this.welfareTicketType(),color:this.welfareTicketColor(),image:this.welfareTicketImage(),settings:i}).then((function(){return t.hide()}),(function(e){t.loading=!1,t.handleErrors(e)})):app.store.createRecord("welfareTicketList").save({id:this.welfareTicketID(),title:this.welfareTicketTitle(),cost:this.welfareTicketCost(),type:this.welfareTicketType(),color:this.welfareTicketColor(),image:this.welfareTicketImage(),settings:i}).then((function(e){location.reload()})).catch((function(e){t.loading=!1,t.handleErrors(guagualeList)}))},t}(d());k.isDismissible=!1;const g=flarum.core.compat.Component;var v=e.n(g),T=function(e){function t(){return e.apply(this,arguments)||this}i(t,e);var a=t.prototype;return a.oninit=function(t){e.prototype.oninit.call(this,t),this.welfareTicketData=this.attrs.welfareTicketData,this.loading=!1},a.className=function(){return"Modal--small"},a.title=function(){return app.translator.trans("wusong8899-welfare-ticket.admin.welfare-item-delete-confirmation")},a.content=function(){var e=this;return m("div",{className:"Modal-body"},m("div",{className:"Form-group",style:"text-align: center;"},c().component({className:"Button Button--primary",type:"submit",loading:this.loading},app.translator.trans("wusong8899-welfare-ticket.admin.welfare-data-confirm"))," ",c().component({className:"Button welfareTicketButton--gray",loading:this.loading,onclick:function(){e.hide()}},app.translator.trans("wusong8899-welfare-ticket.admin.welfare-data-cancel"))))},a.onsubmit=function(e){var t=this;e.preventDefault(),this.loading=!0,this.welfareTicketData.save({activated:2}).then((function(){return location.reload()}),(function(e){t.loading=!1,t.handleErrors(e)}))},t}(d());T.isDismissible=!1;const y=flarum.core.compat["helpers/username"];var b=e.n(y),C=function(e){function t(){return e.apply(this,arguments)||this}i(t,e);var a=t.prototype;return a.view=function(){var e=this,t=this.attrs.welfareTicketData,a=app.forum.attribute("antoinefr-money.moneyname")||"[money]",i=t.id().toString(),r=i.substring(1),n=i[0],l=(t.title(),t.color()),o=t.image(),s=t.cost(),p=t.assignedAt(),d=JSON.parse(t.settings()),u=d.dealerBet,f=d.dealerBetCut,w=d.win1Multiplier,h=d.win2Multiplier,k=d.win3Multiplier,g=t.dealerData(),v=!1===g?app.translator.trans("wusong8899-welfare-ticket.admin.welfare-item-dealer-none"):b()(g),T=a.replace("[money]",s),y=a.replace("[money]",u),C="width:200px;height:60px;background-image:url("+(null===o?"":o)+");background-color: "+(l||this.getBackgroundColor(p))+";";return m("div",{style:"border: 1px dotted var(--control-color);padding: 10px;border-radius: 4px;"},m("div",null,m("div",{style:"padding-top: 5px;"},m(c(),{className:"Button Button--primary",onclick:function(){return e.editItem(t)}},app.translator.trans("wusong8899-guaguale.admin.settings.guaguale-item-edit"))," ",m(c(),{style:"font-weight:bold;width:66px;",className:"Button Button--danger",onclick:function(){return e.deleteItem(t)}},app.translator.trans("wusong8899-guaguale.admin.settings.guaguale-item-delete"))),m("div",{style:"padding-top: 5px;"},m("b",null,app.translator.trans("wusong8899-welfare-ticket.admin.welfare-item-type"),": "),app.translator.trans("wusong8899-welfare-ticket.admin.welfare-item-type-"+n)," | ",m("b",null,app.translator.trans("wusong8899-welfare-ticket.admin.welfare-item-id"),": "),r," | ",m("b",null,app.translator.trans("wusong8899-welfare-ticket.admin.welfare-item-cost"),": "),T," | ",m("b",null,app.translator.trans("wusong8899-welfare-ticket.admin.welfare-item-dealer-name"),": "),v," | ",m("b",null,app.translator.trans("wusong8899-welfare-ticket.admin.welfare-item-dealerBet"),": "),y," | ",m("b",null,app.translator.trans("wusong8899-welfare-ticket.admin.welfare-item-dealerBetCut"),": "),f,"%",m("br",null),m("b",null,app.translator.trans("wusong8899-welfare-ticket.admin.welfare-item-win-multiplier"),": "),app.translator.trans("wusong8899-welfare-ticket.admin.welfare-item-win-1multiplier"),":",w,"X / ",app.translator.trans("wusong8899-welfare-ticket.admin.welfare-item-win-2multiplier"),":",h,"X / ",app.translator.trans("wusong8899-welfare-ticket.admin.welfare-item-win-3multiplier"),":",k,"X")),m("div",{style:"padding-top:5px;"},m("div",{class:"GuaGuaLeImageSettingsContainer",style:C})))},a.editItem=function(e){app.modal.show(k,{welfareTicketData:e})},a.deleteItem=function(e){app.modal.show(T,{welfareTicketData:e})},a.getBackgroundColor=function(e){for(var t=0,a=0;a<e.length;a++)t=e.charCodeAt(a)+((t<<5)-t);for(var i="#",r=0;r<3;r++)i+=("00"+(t>>8*r&255).toString(16)).substr(-2);return i},t}(v()),z=function(e){function t(){return e.apply(this,arguments)||this}i(t,e);var a=t.prototype;return a.oninit=function(t){e.prototype.oninit.call(this,t),this.loading_welfare=!0,this.welfareTicketList=[],this.loadResults()},a.content=function(){return this.loading_welfare&&o().component({size:"large"}),m("div",{className:"ExtensionPage-settings FlarumBadgesPage"},m("div",{className:"container"},this.buildSettingComponent({type:"string",setting:"wusong8899-welfare-ticket.welfareDisplayName",label:app.translator.trans("wusong8899-welfare-ticket.admin.settings.welfare-display-name"),placeholder:app.translator.trans("wusong8899-welfare-ticket.admin.settings.welfare-display-name-default")}),this.buildSettingComponent({type:"string",setting:"wusong8899-welfare-ticket.welfareTimezone",label:app.translator.trans("wusong8899-welfare-ticket.admin.settings.welfare-timezone"),help:app.translator.trans("wusong8899-welfare-ticket.admin.settings.welfare-timezone-help"),placeholder:app.translator.trans("wusong8899-welfare-ticket.admin.settings.welfare-timezone-default")}),m("div",{className:"Form-group"},this.submitButton()),m("div",{style:"padding-bottom:10px"},m(c(),{className:"Button",onclick:function(){return app.modal.show(k)}},app.translator.trans("wusong8899-welfare-ticket.admin.welfare-add"))),m("div",{style:"padding:10px 0px 20px 0px"},this.welfareTicketList.map((function(e){return m("div",{style:"padding-top:5px"},C.component({welfareTicketData:e}))})))))},a.parseResults=function(e){return[].push.apply(this.welfareTicketList,e),this.loading_welfare=!1,m.redraw(),e},a.loadResults=function(){return app.store.find("welfareTicketList",{page:{filter:{item:"all"}}}).catch((function(){})).then(this.parseResults.bind(this))},t}(n());const B=flarum.core.compat.Model;var D=e.n(B),x=function(e){function t(){return e.apply(this,arguments)||this}return i(t,e),t}(D());Object.assign(x.prototype,{id:D().attribute("id"),title:D().attribute("title"),desc:D().attribute("desc"),playback:D().attribute("playback"),color:D().attribute("color"),image:D().attribute("image"),type:D().attribute("type"),cost:D().attribute("cost"),purchased_total:D().attribute("purchased_total"),bet_total:D().attribute("bet_total"),dealer_id:D().attribute("dealer_id"),result:D().attribute("result"),settings:D().attribute("settings"),assignedAt:D().attribute("assigned_at"),activated:D().attribute("activated"),dealerData:D().hasOne("dealerData")}),app.initializers.add("wusong8899-client1-welfare-ticket",(function(){app.store.models.welfareTicketList=x,app.extensionData.for("wusong8899-client1-welfare-ticket").registerPage(z)}))})(),module.exports=t})();
//# sourceMappingURL=admin.js.map